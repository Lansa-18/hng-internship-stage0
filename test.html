<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Card Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        line-height: 1.6;
      }
      .test-result {
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
      }
      .pass {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .fail {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      iframe {
        width: 100%;
        height: 600px;
        border: 1px solid #ccc;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <h1>Profile Card - Test Results</h1>

    <div id="test-results"></div>

    <h2>Profile Card Preview</h2>
    <iframe src="index.html" title="Profile Card Preview"></iframe>

    <script>
      // Test function to validate all requirements
      function runTests() {
        const results = [];

        // Required data-testid attributes
        const requiredTestIds = [
          "test-profile-card",
          "test-user-name",
          "test-user-bio",
          "test-user-time",
          "test-user-avatar",
          "test-user-social-links",
          "test-user-hobbies",
          "test-user-dislikes",
        ];

        // Test iframe content
        const iframe = document.querySelector("iframe");
        iframe.onload = function () {
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;

          // Test 1: Check all required data-testid attributes
          requiredTestIds.forEach((testId) => {
            const element = iframeDoc.querySelector(
              `[data-testid="${testId}"]`
            );
            if (element) {
              results.push({
                test: `data-testid="${testId}"`,
                status: "pass",
                message: `Found element with ${testId}`,
              });
            } else {
              results.push({
                test: `data-testid="${testId}"`,
                status: "fail",
                message: `Missing element with ${testId}`,
              });
            }
          });

          // Test 2: Check semantic HTML elements
          const semanticTests = [
            {
              selector: 'article[data-testid="test-profile-card"]',
              name: "Article element for profile card",
            },
            {
              selector: 'h1[data-testid="test-user-name"]',
              name: "H1 element for user name",
            },
            {
              selector: 'p[data-testid="test-user-bio"]',
              name: "Paragraph element for bio",
            },
            {
              selector: 'img[data-testid="test-user-avatar"]',
              name: "Image element for avatar",
            },
            {
              selector: 'ul[data-testid="test-user-social-links"]',
              name: "List element for social links",
            },
            {
              selector: 'ul[data-testid="test-user-hobbies"]',
              name: "List element for hobbies",
            },
            {
              selector: 'ul[data-testid="test-user-dislikes"]',
              name: "List element for dislikes",
            },
          ];

          semanticTests.forEach((test) => {
            const element = iframeDoc.querySelector(test.selector);
            if (element) {
              results.push({
                test: test.name,
                status: "pass",
                message: `Correct semantic element found`,
              });
            } else {
              results.push({
                test: test.name,
                status: "fail",
                message: `Incorrect or missing semantic element`,
              });
            }
          });

          // Test 3: Check avatar alt attribute
          const avatar = iframeDoc.querySelector(
            '[data-testid="test-user-avatar"]'
          );
          if (avatar && avatar.alt) {
            results.push({
              test: "Avatar alt attribute",
              status: "pass",
              message: `Alt text: "${avatar.alt}"`,
            });
          } else {
            results.push({
              test: "Avatar alt attribute",
              status: "fail",
              message: "Avatar missing alt attribute",
            });
          }

          // Test 4: Check social links target and rel attributes
          const socialLinks = iframeDoc.querySelectorAll(
            '[data-testid="test-user-social-links"] a'
          );
          socialLinks.forEach((link, index) => {
            if (link.target === "_blank" && link.rel.includes("noopener")) {
              results.push({
                test: `Social link ${index + 1} security`,
                status: "pass",
                message: "Correct target and rel attributes",
              });
            } else {
              results.push({
                test: `Social link ${index + 1} security`,
                status: "fail",
                message: 'Missing target="_blank" or rel="noopener noreferrer"',
              });
            }
          });

          // Test 5: Check time element content
          const timeElement = iframeDoc.querySelector(
            '[data-testid="test-user-time"]'
          );
          if (timeElement && timeElement.textContent) {
            const timeValue = parseInt(timeElement.textContent);
            const currentTime = Date.now();
            const timeDiff = Math.abs(currentTime - timeValue);

            if (timeDiff < 5000) {
              // Within 5 seconds
              results.push({
                test: "Current time accuracy",
                status: "pass",
                message: `Time is current (${timeValue})`,
              });
            } else {
              results.push({
                test: "Current time accuracy",
                status: "fail",
                message: `Time seems outdated (${timeValue})`,
              });
            }
          } else {
            results.push({
              test: "Current time presence",
              status: "fail",
              message: "Time element empty or missing",
            });
          }

          // Display results
          displayResults(results);
        };
      }

      function displayResults(results) {
        const container = document.getElementById("test-results");
        let html = "<h2>Test Results</h2>";

        const passedTests = results.filter((r) => r.status === "pass").length;
        const totalTests = results.length;

        html += `<div class="info">
                <strong>Summary:</strong> ${passedTests}/${totalTests} tests passed
            </div>`;

        results.forEach((result) => {
          html += `<div class="test-result ${result.status}">
                    <strong>${result.test}:</strong> ${result.message}
                </div>`;
        });

        container.innerHTML = html;
      }

      // Run tests when page loads
      window.addEventListener("load", runTests);
    </script>
  </body>
</html>
